(()=>{"use strict";let t,e,a,i,o=!1;function s(e,a){document.querySelectorAll(".search-country").forEach((t=>t.value="[Enter city]")),t="",a.innerHTML="",e.target.blur()}const r=["TotalConfirmed","TotalDeaths","TotalRecovered","NewConfirmed","NewDeaths","NewRecovered"];function c(){e.dispose()}class n{constructor(){this.chart}createDiagram(t){this.chart=am4core.create("diagram",am4charts.XYChart),this.chart.data=t,this.chart.xAxes.push(new am4charts.CategoryAxis).dataFields.category="date",this.chart.yAxes.push(new am4charts.ValueAxis);const e=this.chart.series.push(new am4charts.LineSeries);e.dataFields.valueY="value",e.dataFields.categoryX="date",e.name="value",e.tooltipText="[bold]{categoryX}:[/] {valueY}",e.strokeWidth=3,this.chart.cursor=new am4charts.XYCursor}clear(){this.chart.dispose()}}const h=7827e6,d=new class{constructor(){this.covidList,this.selectListData,this.map,this.diagram,this.wrapper,this.chartWrapper,this.wrapperData,this.init()}createElement(t,e,a,i){const o=document.createElement(t);return o.className=e,i&&(o.innerHTML=i),a.appendChild(o),o}init(){const t=this.createElement("header","header",document.body);this.createElement("h1","header__title",t,"COVID-19 Dashboard");const e=this.createElement("main","main",document.body);this.wrapper=this.createElement("div","wrapper",e),this.chartWrapper=this.createElement("div","chart__wrapper",this.wrapper),this.wrapperData=this.createElement("div","data-wrapper",this.wrapper),this.addMap(),this.addDiagram(),this.createFooter()}createFooter(){const t=this.createElement("footer","footer",document.body);this.createElement("span","footer__item",t,"2020");let e=this.createElement("a","footer__item",t," Â© tatafox");e.href="https://github.com/tatafox",e.target="_blank",e=this.createElement("a","footer__item",t),e.href="https://rs.school/js/",e.target="_blank",this.createElement("img","footer__img",e).src="https://rs.school/images/rs_school_js.svg"}addDiagram(){const t=this.createElement("div","diagram-wrapper",this.chartWrapper);this.createControlPanel(t,"map"),this.diagram=this.createElement("div","diagram",t),this.diagram.id="diagram"}addMap(){const t=this.createElement("div","map-wrapper",this.chartWrapper);this.createControlPanel(t,"map"),this.map=this.createElement("div","map",t),this.map.id="map"}createCheckbox(t,e,a,i){const o=this.createElement("div","checkbox-item__wrapper",t),s=this.createElement("input",e,o);return s.type="checkbox",s.id=i+e,s.name=i+e,this.createElement("label",e+"_label",o,a).htmlFor=i+e,s}addCovidTable(){const t=this.createElement("div","covid-table",this.wrapperData),e=this.createElement("div","control__wrapper",t);this.addCountrySearch(e,"country-search__table");const a=this.createElement("button","button__expand",e);this.createElement("img","button__img",a).src="./assets/expand-button.svg";const i=this.createElement("div","checkbox__wrapper",e);this.createCheckbox(i,"checkbox__last-day","New cases","table-"),this.createCheckbox(i,"checkbox__one-hundr-thous","per 100 000 population","table-"),this.covidTableData=this.createElement("div","covid-table__data",t)}addCovidTableData(t,e,a){this.clearDOMItem(this.covidTableData);let i=this.createElement("div","covid-table__item",this.covidTableData);this.createElement("span","covid-table__span",i,"Confirmed:"),this.createElement("span","covid-table__span",i,t),i=this.createElement("div","covid-table__item",this.covidTableData),this.createElement("span","covid-table__span",i,"Deaths:"),this.createElement("span","covid-table__span",i,e),i=this.createElement("div","covid-table__item",this.covidTableData),this.createElement("span","covid-table__span",i,"Recovered:"),this.createElement("span","covid-table__span",i,a)}addCountrySearch(t,e){const a=this.createElement("input","search-country",t);a.value="[Enter city]",a.setAttribute("list",e),this.createElement("datalist","",a).id=e}createControlPanel(t,e){const a=this.createElement("div","list-control",t);this.createCheckbox(a,"checkbox__one-hundr-thous","per 100 000 population",e);const i=this.createElement("select",e+"__select select-data",a);let o=this.createElement("option",e+"__select",i,"Total confirmed");o.selected="selected",o=this.createElement("option",e+"__select",i,"Total death"),o=this.createElement("option",e+"__select",i,"Total recovered"),o=this.createElement("option",e+"__select",i,"New confirmed"),o=this.createElement("option",e+"__select",i,"New death"),o=this.createElement("option",e+"__select",i,"New recovered"),this.addCountrySearch(a,e+"__country-search");const s=this.createElement("button","button__expand",a);this.createElement("img","button__img",s).src="./assets/expand-button.svg"}addCovidList(){const t=this.createElement("div","list-wrapper",this.wrapperData);this.createControlPanel(t,"covid-list"),this.covidList=this.createElement("ul","covid-list",t)}clearDOMItem(t){t.innerHTML=""}createListItem(t,e,a){const i=this.createElement("li","covid-item",this.covidList),o=this.createElement("img","covid-item__data",i);o.src=a,o.width="50",this.createElement("span","covid-item__data",i,t),this.createElement("span","covid-item__data",i,e)}},l=new class{constructor(){this.loading=!1,this.loadingCountry=!1}async getCovidClobalData(){let t;this.loadingCountry=!0;try{const e="https://disease.sh/v3/covid-19/all",a=await fetch(e);t=await a.json()}catch(t){}finally{this.loadingCountry=!1}return t}async getCovidCountryData(){let t;this.loadingCountry=!0;try{const e="https://disease.sh/v3/covid-19/countries",a=await fetch(e);t=await a.json()}catch(t){}finally{this.loadingCountry=!1}return t}async getCovidHistoricalAllData(){let t;this.loadingCountry=!0;try{const e="https://disease.sh/v3/covid-19/historical/all?lastdays=366",a=await fetch(e);t=await a.json()}catch(t){}finally{this.loadingCountry=!1}return t}async getCovidHistoricalCountryData(t){let e;this.loadingCountry=!0;try{const a=`https://disease.sh/v3/covid-19/historical/${t}?lastdays=366`,i=await fetch(a);e=await i.json()}catch(t){}finally{this.loadingCountry=!1}return e.timeline}};new class{constructor(t,e){this.view=t,this.model=e,this.dataCovidCountry={},this.dataCovidGlobal={},this.dataHistoricalAll={},this.dataHistoricalCountry={},this.checkboxLastDay=!1,this.checkboxOneHundThous=!1,this.country,this.covidList,this.dataType,this.dataMap,this.diagram=new n,this.init()}init(){this.getCovidData(),this.view.addCovidTable(),this.view.addCovidList(),this.getCovidHistoricalAllData(),i=am4core.create("map",am4maps.MapChart),i.zoomControl=new am4maps.ZoomControl,i.zoomControl.align="left",i.zoomControl.marginRight=20,i.zoomControl.valign="top",i.geodata=am4geodata_worldLow,i.projection=new am4maps.projections.Miller,document.querySelectorAll(".select-data").forEach((t=>{t.addEventListener("change",(t=>this.changeListData(t)))})),document.querySelectorAll(".button__expand").forEach((t=>{t.addEventListener("click",(t=>this.clickButtonExpand(t)))})),document.querySelectorAll(".checkbox__last-day").forEach((t=>{t.addEventListener("click",(()=>this.setCheckboxLastDay()))})),document.querySelectorAll(".checkbox__one-hundr-thous").forEach((t=>{t.addEventListener("click",(()=>this.setCheckboxOneHundThous()))})),document.querySelectorAll(".search-country").forEach((t=>{t.addEventListener("keydown",(t=>this.changeCounty(t,"set"))),t.addEventListener("click",(t=>this.changeCounty(t,"click"))),t.addEventListener("blur",(t=>this.changeCounty(t,"set")))}))}clickButtonExpand(t){t.path[3].classList.toggle("full-screen")}setCovidDataList(){const t=[];if(this.view.clearDOMItem(this.view.covidList),document.querySelectorAll(".covid-item").forEach((t=>{t.removeEventListener("click")})),this.dataCovidCountry.forEach((e=>{let a=this.switchCovidData(e);const i=e.population?e.population:1e5;a=this.checkboxOneHundThous?Math.round(1e7*a/i)/100:a;const o=[e.country,a,e.countryInfo.flag];t.push(o)})),this.country){const e=t.find((t=>t[0]===this.country.country));this.view.createListItem(e[0],e[1],e[2])}else t.sort(((t,e)=>e[1]-t[1])),t.forEach((t=>{this.view.createListItem(t[0],t[1],t[2])}));document.querySelectorAll(".covid-item").forEach((t=>{t.addEventListener("click",(t=>this.setCountryClick(t)))}))}setCountryClick(t){const e="li"===t.target.localName?t.target.children[1].innerText:t.path[1].children[1].textContent;this.country=this.dataCovidCountry.find((t=>t.country.toLowerCase()===e.toLowerCase())),document.querySelectorAll(".search-country").forEach((t=>t.value=this.country.country)),this.updateCounty()}setCheckboxLastDay(){this.checkboxLastDay=!this.checkboxLastDay,this.setCheckbox(),document.querySelectorAll(".checkbox__last-day").forEach((t=>{t.checked=this.checkboxLastDay}))}setCheckboxOneHundThous(){this.checkboxOneHundThous=!this.checkboxOneHundThous,this.setCheckbox(),document.querySelectorAll(".checkbox__one-hundr-thous").forEach((t=>{t.checked=this.checkboxOneHundThous}))}setCheckbox(){const t=this.country?this.country:this.dataCovidGlobal;this.changeCovidTableData(t,h),c(),this.updateMap(),this.setCovidDataList(),this.country?this.updateDiagram(this.dataHistoricalCountry):this.updateDiagram(this.dataHistoricalAll)}changeListData(t){document.querySelectorAll(".select-data").forEach((e=>{e.value=t.target.value})),this.dataType=t.target.value,this.setCovidDataList(),c(),this.updateMap(),this.country?this.updateDiagram(this.dataHistoricalCountry):this.updateDiagram(this.dataHistoricalAll)}changeCounty(e,a){"set"===a?function(e,a){const i=e.path[0].children[0];if(o=!1,"blur"===e.type||"keydown"===e.type&&(13==e.which||13==e.keyCode))o=!0,""===e.target.value?s(e,i):(t=a.filter((t=>t.country.toLowerCase()===e.target.value.toLowerCase())),t&&0!==t.length?(e.target.value=t[0].country,document.querySelectorAll(".search-country").forEach((e=>e.value=t[0].country))):s(e,i),e.target.blur());else if("keydown"===e.type&&(13!==e.which||13!==e.keyCode)){i.innerHTML="";const t="Backspace"===e.key?e.target.value.slice(0,-1):e.target.value+e.key;a.filter((e=>-1!==e.country.toLowerCase().indexOf(t.toLowerCase()))).forEach((t=>{const e=document.createElement("option");e.setAttribute("value",t.country),i.appendChild(e)}))}}(e,this.dataCovidCountry):function(t){t.target.value=""}(e),o&&(t?(this.country=t[0],this.updateCounty()):this.resetCounty())}switchCovidData(t,e,a){let i;switch(this.dataType){case"Total death":i=e?this.getDiagramData(t.deaths,!1,a):t?t.deaths:"TotalDeaths";break;case"Total recovered":i=e?this.getDiagramData(t.recovered,!1,a):t?t.recovered:"TotalRecovered";break;case"New confirmed":i=e?this.getDiagramData(t.cases,!0,a):t?t.todayCases:"NewConfirmed";break;case"New death":i=e?this.getDiagramData(t.deaths,!0,a):t?t.todayDeaths:"NewDeaths";break;case"New recovered":i=e?this.getDiagramData(t.recovered,!0,a):t?t.todayRecovered:"NewRecovered";break;default:i=e?this.getDiagramData(t.cases,!1,a):t?t.cases:"TotalConfirmed"}return i}updateCounty(){var t;t=e.getPolygonById(this.country.countryInfo.iso2),i.zoomToMapObject(t,function(t){const e=t.polygon.bbox.width,a=t.polygon.bbox.width;return Math.min(i.seriesWidth/(2*e),i.seriesHeight/(2*a))}(t)),this.setCovidDataList(),this.changeCovidTableData(this.country,this.country.population),this.getCovidHistoricalCountryData()}updateMap(){var t;t=this.dataMap,e=i.series.push(new am4maps.MapPolygonSeries),e.useGeodata=!0,e.exclude=["AQ"],a=e.mapPolygons.template,a.fill=am4core.color("#15B2D6"),a.states.create("hover").properties.opacity=.5,e.data=t,a.dataItem=t,a.events.on("hit",(t=>{this.country=this.dataCovidCountry.find((e=>e.countryInfo.iso2===t.target.dataItem._dataContext.id)),document.querySelectorAll(".search-country").forEach((t=>t.value=this.country.country)),this.updateCounty()})),function(t,e,i){const o=r.find((e=>e===t));e.sort(((t,e)=>e[o]-t[o]));const s=e[0][o];a.adapter.add("fillOpacity",(function(t,e){const a=e.dataItem._dataContext[o];return a?.7*a/s+.2:.2})),a.adapter.add("tooltipText",(function(t,e){const a=e.dataItem._dataContext[o],s=a?1e5*a/e.dataItem._dataContext.population:0;return"[bold]{name}:[/] "+(i?Math.round(100*s)/100:a)+" "}))}(this.switchCovidData(),this.dataMap,this.checkboxOneHundThous)}resetCounty(){this.country="",this.changeCovidTableData(this.dataCovidGlobal,h),this.setCovidDataList(),this.updateDiagram(this.dataHistoricalAll),i.goHome()}updateDiagram(t){this.diagram.clear();let e=this.country?this.country.population:h;e=this.checkboxOneHundThous?e:0;const a=this.switchCovidData(t,!0,e);this.diagram.createDiagram(a)}changeCovidTableData(t,e){let a=this.checkboxLastDay?t.todayCases:t.cases,i=this.checkboxLastDay?t.todayDeaths:t.deaths,o=this.checkboxLastDay?t.todayRecovered:t.recovered;e=e?e/1e5:1,this.checkboxOneHundThous&&(a=Math.round(a/e*100)/100,i=Math.round(i/e*100)/100,o=Math.round(o/e*100)/100),this.view.addCovidTableData(a,i,o)}getDiagramData(t,e,a){const i=[];let o=0;for(const[s,r]of Object.entries(t)){const t={date:s,value:a?Math.round(1e5*(r-o)/a*100)/100:r-o};i.push(t),o=e?r:0}return i}async getCovidData(){this.dataCovidGlobal=await this.model.getCovidClobalData(),this.dataCovidCountry=await this.model.getCovidCountryData(),this.view.addCovidTableData(this.dataCovidGlobal.cases,this.dataCovidGlobal.deaths,this.dataCovidGlobal.recovered),this.covidList=this.view.covidList,this.setCovidDataList(),this.dataMap=function(t){const e=[];return t.forEach((t=>{const a={id:t.countryInfo.iso2,population:t.population,TotalConfirmed:t.cases,TotalDeaths:t.deaths,TotalRecovered:t.recovered,NewConfirmed:t.todayCases,NewDeaths:t.todayDeaths,NewRecovered:t.todayRecovered};e.push(a)})),e}(this.dataCovidCountry),this.updateMap()}async getCovidHistoricalAllData(){this.dataHistoricalAll=await this.model.getCovidHistoricalAllData();const t=this.getDiagramData(this.dataHistoricalAll.cases,!1);this.diagram.createDiagram(t)}async getCovidHistoricalCountryData(){this.dataHistoricalCountry=await this.model.getCovidHistoricalCountryData(this.country.countryInfo.iso2),this.updateDiagram(this.dataHistoricalCountry)}}(d,l)})();